{% extends 'layout.html' %}

{% block title %}
User Profile
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style_for_profile.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
{% endblock %}

{% block main_content %}
<div class="container py-5">
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('user.profile') }}">
        {{ form.hidden_tag() }}
        <div class="card profile-card p-4 shadow-lg border-0">
            <h2 class="text-center mb-4">My Profile</h2>

            <div class="mb-3">
                {{ form.full_name.label(class="form-label") }}
                {{ form.full_name(class="form-control") }}
            </div>

            <div class="mb-3">
                {{ form.bio.label(class="form-label") }}
                {{ form.bio(class="form-control", rows=3) }}
            </div>

            <div class="mb-3">
                {{ form.date_of_birth.label(class="form-label") }}
                {{ form.date_of_birth(class="form-control datepicker") }}
            </div>

            <div class="mb-3">
                {{ form.profile_pic.label(class="form-label") }}
                {{ form.profile_pic(class="form-control", accept="image/*") }}
            </div>

            <!-- Save and Delete Buttons -->
            <div class="d-flex justify-content-between flex-wrap mt-4">
                {{ form.save_changes(class="btn btn-success px-4 mb-2") }}

                <!-- Trigger modal -->
                {% if current_user.role == 'UserRole.USER' %}
                <button type="button" class="btn btn-danger px-4 mb-2" data-bs-toggle="modal"
                    data-bs-target="#deleteModal">
                    Delete Profile
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Hidden delete button to trigger from modal -->
        {{ form.delete_profile(class="d-none", id="hiddenDeleteBtn") }}
    </form>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="deleteModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Your account will be deleted after 15 days. If you log in before that, it will be reactivated. Proceed?
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <!-- Trigger hidden delete button from main form -->
                <button type="button" class="btn btn-danger"
                    onclick="document.getElementById('hiddenDeleteBtn').click();">
                    Confirm Delete
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        flatpickr(".datepicker", {
            dateFormat: "Y-m-d",
            maxDate: "today",
            theme: "dark",
            allowInput: true,
        });
    });
</script>
{% endblock %}